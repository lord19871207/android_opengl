#version 300 es

uniform sampler2D sTexture;
uniform vec2 uPixelSize;

in vec2 vTexPosition;

out vec4 outFragColor;

const float[25] sobel5x5 = float[]( -5.0,  -4.0,   0.0,   4.0,   5.0,
                                    -8.0, -10.0,   0.0,  10.0,   8.0,
                                   -10.0, -20.0,   0.0,  20.0,  10.0,
                                    -8.0, -10.0,   0.0,  10.0,   8.0,
                                    -5.0,  -4.0,   0.0,   4.0,   5.0);

float intensity(int dx, int dy) {
    vec3 c = texture(sTexture, vTexPosition + uPixelSize * vec2(dx, dy)).rgb;
    return length(c);
}

void main() {
    float sx = 0.0;
    float sy = 0.0;
    for (int idx = 0; idx < 25; ++idx) {
        int i = idx / 5;
        int j = idx - i * 5;
        float intensity = intensity(i - 2, j - 2);
        sx += sobel5x5[i * 5 + j] * intensity;
        sy += sobel5x5[j * 5 + i] * intensity;

    }
    float c = length(vec2(sx, sy)) * (1.0 / 28.0);
    outFragColor = vec4(texture(sTexture, vTexPosition).rgb * c, 1.0);
}
